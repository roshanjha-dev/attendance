<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Barcode Scanner to Excel</title>
    <script src="https://unpkg.com/quagga"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        #scanner-container { width: 100%; max-width: 400px; margin: 20px auto; }
        #data { font-size: 18px; margin-top: 10px; }
        button { margin: 10px; padding: 10px; font-size: 16px; }
    </style>
</head>
<body>
    <h2>Barcode Scanner</h2>
    <div id="scanner-container"></div>
    <p id="data">Scan a barcode...</p>
    <button onclick="downloadExcel()">Download Excel</button>

    <script>
        let scannedData = []; // Store scanned barcode data

        function startScanner() {
            Quagga.init({
                inputStream: {
                    type: "LiveStream",
                    constraints: { facingMode: "environment" }, // Use back camera
                    target: document.querySelector("#scanner-container")
                },
                decoder: { readers: ["code_128_reader", "ean_reader", "upc_reader"] } // Supported barcodes
            }, function(err) {
                if (err) {
                    console.error(err);
                    return;
                }
                Quagga.start();
            });

            Quagga.onDetected(function(result) {
                let barcode = result.codeResult.code;
                document.getElementById("data").innerText = "Scanned: " + barcode;

                // Save to array (avoid duplicates)
                if (!scannedData.includes(barcode)) {
                    scannedData.push([barcode]); 
                }
            });
        }

        function downloadExcel() {
            let ws = XLSX.utils.aoa_to_sheet([["Barcode Data"], ...scannedData]);
            let wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "Scanned Barcodes");
            XLSX.writeFile(wb, "Scanned_Barcodes.xlsx");
        }

        startScanner(); // Start scanning on page load
    </script>
</body>
</html>
